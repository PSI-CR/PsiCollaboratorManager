
@{
    Layout = "~/Views/Shared/_basicSmall.cshtml";
}

<link href="~/Content/Css/UserAccount/Index.css" rel="stylesheet" />
<link href="~/Content/JQGridTheme/jquery-ui.css" rel="stylesheet" />
<link href="~/Content/JQGridTheme/ui.multiselect.css" rel="stylesheet" />
<link href="~/Content/JQGridTheme/ui.jqgrid.css" rel="stylesheet" />
<link href="~/Content/JQGridTheme/JqGridStyle.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" media="screen" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" />

<div id="TableContainer" class="fieldset">
    <table id="jqGrid"></table>
    <div id="jqGridPager"></div>
</div>

<script src="~/Scripts/jqGrid/jquery.min.js"></script>
<script src="~/Scripts/jqGrid/jquery-ui.min.js"></script>
<script src="~/Scripts/jqGrid/ui.multiselect.js"></script>
<script src="~/Scripts/jqGrid/grid.locale-es.js"></script>
<script src="~/Scripts/jqGrid/jquery.jqGrid.min.js"></script>
<script src="~/Scripts/jqGrid/context-menu.js"></script>

<script>
    $(function () {

        $grid = $("#jqGrid").jqGrid({
            url: '@Url.Action("GetData", "LoginUserAccount")',
            mtype: 'GET',
            datatype: 'json',
            shrinkToFit: true,
            colModel: [
                {label: 'User Account Id ',name: 'UserAccountId', width: 50, minWidth: 20, editable: false, key: true, hidden: true, align: 'center'},
                { label: 'Usuario', name: 'UserName', width: 200, minWidth: 200 },
                { label: 'Nombre', name: 'FirstName', width: 200, minWidth: 200 },
                { label: 'Apellidos', name: 'LastName', width: 200, minWidth: 200   },
                {label: 'E-mail', name: 'Email', width: 200, minWidth: 200, formatter: 'email'},
                {label: "Esta Activo", name: 'IsActive', width: 100, minWidth: 100, align: 'center', formatter: "checkbox", formatoptions: { disabled: true }},
            ],

            onInitGrid: function () {
                $("<div class='alert-info-grid'>No Record(s) Found</div>").insertAfter($(this).parent());
            },

            loadComplete: function () {
                var $this = $(this), p = $this.jqGrid("getGridParam");
                if (p.reccount === 0) {
                    $this.hide();
                    $this.parent().siblings(".alert-info-grid").show();
                } else {
                    $this.show();
                    $this.parent().siblings(".alert-info-grid").hide();
                }
            },


            resizeStop: function (newWidth, index) {
                var colModel = $(this).jqGrid('getGridParam', 'colModel');
                var column = colModel[index];

                console.log(newWidth);
                if (column.width < column.minWidth) {
                    $(this).jqGrid('setGridParam', {
                        colModel: colModel
                    }).trigger('resize');
                }
            },

            ondblClickRow: function (rowId) {
                displayDetails()
            },

            loadonce: true,
            shrinkToFit: true,
            altRows: true,
            pager: '#jqGridPager',
            rowNum: 20,
            rowList: [10, 20, 30, 50],
            viewrecords: true,
            rownumbers: true,
            sortable: true,
            autowidth: true,
            autoresizeOnLoad: true,
            autoresizeOnResize: true,
            gridComplete: initGrid,
            height: '100%'

        });

        $(window).on("resize", function () {
            $("#jqGrid").jqGrid("setGridWidth", $("#jqGrid").closest(".ui-jqgrid").parent().width());
        });

        $('#jqGrid').navGrid('#jqGridPager',
            { edit: false, add: false, del: false, search: true, refresh: true, view: false, position: "left", cloneToTop: true }, { multipleSearch: true, multipleGroup: true } );


        $('#jqGrid').navButtonAdd('#jqGridPager',
            {
                buttonicon: "ui-icon-calculator",
                title: "Column chooser",
                caption: "Columnas",
                position: "last",
                onClickButton: function () {
                    jQuery("#jqGrid").jqGrid('columnChooser', {
                        done: function (numColumn) {
                            $("#jqGrid").jqGrid('setGridParam', {
                            }).trigger('resize');
                        }
                    });
                }
            }
        );

        $('#jqGrid').navButtonAdd('#jqGridPager',
            {
                buttonicon: "ui-icon-pencil",
                title: "Edit",
                caption: "Editar",
                position: "last",
                onClickButton: editRow
            }
        );

        $('#jqGrid').navButtonAdd('#jqGridPager',
            {
                buttonicon: "ui-icon-plusthick",
                title: "Add",
                caption: "Agregar",
                position: "last",
                onClickButton: addRow
            }
        );

    });


    function resizeJqGridWidth(grid_id, div_id, width) {
        $(window).bind('resize', function () {
            $('#' + grid_id).setGridWidth(width, true);
            $('#' + grid_id).setGridWidth($('#' + div_id).width(), true);
        }).trigger('resize');
    }

    function initGrid() {
        $(".jqgrow", "#jqGrid").contextMenu('contextMenu', {
            bindings: {
                'edit': function (t) {
                    editRow();
                },
                'add': function (t) {
                    addRow();
                }
                ,
                'details': function (t) {
                    displayDetails();
                }
            },
            onContextMenu: function (event, menu) {
                var rowId = $(event.target).parent("tr").attr("id")
                var grid = $("#jqGrid");
                grid.setSelection(rowId);

                return true;
            }
        });
    }

    function addRow() {
            var grid = $("#jqGrid");
            var editUrl = '@Url.Action("Create", "LoginUserAccount")';
                var fullUrl = window.location.protocol + '//' + window.location.host + editUrl;
                window.location.href = fullUrl;
    }

    function displayDetails() {
        var grid = $("#jqGrid");
        var rowKey = grid.getGridParam("selrow");
        if (rowKey) {
            var key = $("#jqGrid").jqGrid('getCell', rowKey, 'UserAccountId');
            var editUrl = '@Url.Action("Details", "LoginUserAccount", new { id = "_rowId_" })';
            editUrl = editUrl.replace("_rowId_", key);
            var fullUrl = window.location.protocol + '//' + window.location.host + editUrl;
            window.location.href = fullUrl;
        }
    }

    function editRow() {

        var grid = $("#jqGrid");
        var rowKey = grid.getGridParam("selrow");
        if (rowKey) {

            var key = $("#jqGrid").jqGrid('getCell', rowKey, 'UserAccountId');
            var editUrl = '@Url.Action("Edit", "LoginUserAccount", new { id = "_rowId_" })';
            editUrl = editUrl.replace("_rowId_", key);
            var fullUrl = window.location.protocol + '//' + window.location.host + editUrl;
            window.location.href = fullUrl;
        }
        else {
            alert("No rows are selected");
        }
    }
</script>

<link href="~/Scripts/MessiJS/messi.min.css" rel="stylesheet" />
<script src="~/Scripts/MessiJS/messi.min.js"></script>
<script type="text/javascript" src="https://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>



